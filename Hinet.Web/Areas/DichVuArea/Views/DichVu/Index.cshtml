@{
    ViewBag.Title = "Quản lý dịch vụ";
    Layout = "~/Views/Shared/_LayoutAce.cshtml";
    ViewBag.ModuleName = "Quản lý dịch vụ";
    ViewBag.PageName = "Danh sách dịch vụ";
    ViewBag.ModuleCode = "DichVu_index";

}
@using Hinet.Model.IdentityEntities;
@using Hinet.Model.Entities;
@using Newtonsoft.Json;
@using Hinet.Service.Common;
@using Hinet.Service.DichVuService.Dto;
@model PageListResultBO<DichVuDto>
@{
    var lstData = Html.Raw(JsonConvert.SerializeObject(Model.ListItem));
}

@section ActionBarRight{
    <a href="javascript:void(0)" onclick="CreateAction('/DichVuArea/DichVu/Create')" class="btn btn-primary btn-sm"><i class="bi bi-plus-lg"></i> Thêm mới</a>
}
@Html.Partial("_SearchPartial")

<div id="tbl-DichVu" class="hntbl-cover table-scroll">
	<div class="table-wrap">
    <table class="hinet-table table table-striped table-hover" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th class="fixed-side">#</th>
                <th class="fixed-side">Thao tác</th>
				<th>Tên</th>
				<th>Ảnh</th>
				<th>Link</th>
				<th>STT</th>
				<th>Kích hoạt</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
</div>

@section scripts{
    <script>
        var lstData = eval(@lstData);
        var moduleTableSelector="#tbl-DichVu";
        function pagefunction(){
            var conf=[
                {
                    tdClass:"center width50 fixed-side w-0",
                    isSort:false,
                    nameModel: "",
                    isCounter:true,
                    content: function (data) {
                        return "<input type='checkbox'/>"
                    }
                },

                   {
                       isSort:false,
                       nameModel:"",
                       tdClass:"center fixed-side w-0",
                       content: function (data) {
                           var result = `<div class="btn-group">
                               <button data-toggle="dropdown" class="btn btn-xs btn-primary btn-white dropdown-toggle" aria-expanded="false">Thao tác<i class="ace-icon fa fa-angle-down icon-on-right"></i>
                               </button>

                               <ul class="dropdown-menu">`;
                           result += "<li><a href='javascript:void(0)' onclick='EditAction(\"/DichVuArea/DichVu/Edit/" + data.Id + "\")'   title = 'Chỉnh sửa'><i class='bi bi-pencil-square'> </i> Sửa thông tin</a> </li>";
                           result += "<li><a href='javascript:void(0)' onclick='DeleteAction(\"/DichVuArea/DichVu/Delete/" + data.Id + "\")'  title = 'Xóa'><i class=' bi bi-x-lg' style='color:red'> </i> Xóa</a></li>";
                           result += "</ul></div>";
                           return result;
                       }
                   },
                {
                    isSort: true,
                    nameModel: 'Name',
                    content: function (data) {
                        return `<div>
                                <div>${data.Name}</div>
                                <div class="image-upload-box aspect-square" style="width: 80px; padding: 2px">
                                    <img src="${data.DuongDanAnh}" alt="" class="image-preview has-image mb-0 aspect-square h-full object-cover" />
                                </div>
                            </div>`
                    }
                },
				{
					isSort:true,
					nameModel:'DuongDanAnh',
					content: function (data) {
					return data.DuongDanAnh
				}
				},
				{
					isSort:true,
					nameModel:'Link',
					content: function (data) {
					return data.Link
				}
                },
                {
                    isSort: true,
                    nameModel: 'STT',
                    content: function (data) {
                        return data.STT
                    }
                },
                {
                    isSort: true,
                    nameModel: 'KichHoat',
                    content: function (data) {
                        return ` <label class="switch" onClick="toggleKichHoat(${data.Id}, this)">
                                <input type="checkbox" value="true" ${data.KichHoat ? "checked" : ""} disabled>
                               <span class="slider round"></span>
                          </label>`
                    }
                },
            ];

            var getdatafunc=function(page,sortQuery,pageSize){
                $.ajax({
                    url: '/DichVuArea/DichVu/getData',
                    type: 'post',
                    cache: false,
                    data:{"indexPage":page,"sortQuery":sortQuery,"pageSize":pageSize},
                    success: function (data) {
                        $(moduleTableSelector).hinetTable("data",{
                            pageSize:pageSize!=-1?pageSize:data.Count,
                            pageIndex:page,
                            pagecount: data.TotalPage,
                            recordCount: data.Count,
                            listItem: data.ListItem,});
                    },
                    error: function (err) {
                        CommonJS.alert(xhr.responseText);
                    }
                });

            }

            var tblData=$("#tbl-DichVu").hinetTable("init",{
                pageSizeList:{size:[20,50,100,-1],label:['20','50','100','Tất cả']},
                pagecount: @Model.TotalPage,
                recordCount: @Model.Count,
                actionToolBar:'<a href=\"#collapseDiv\" aria-controls=\"collapsePanel\" data-toggle=\"collapse\" role=\"button\" class="btn btn-primary btn-xs"><i class="fa fa-search"></i> Tìm kiếm</a>',
                getData:getdatafunc,
                listItem:lstData,
                config:conf
            });

        }

        function AfterSussessActionAjaxform(){
            $(moduleTableSelector).hinetTable("reload");
        }
        function AjaxSearchSuccess(rs) {
            $(moduleTableSelector).hinetTable("data", {
                pageIndex: 1,
                pagecount: rs.TotalPage,
                recordCount: rs.Count,
                listItem: rs.ListItem,
            });
        }
        pagefunction();

        function toggleKichHoat(id, checkbox) {
            var newState = checkbox.checked;
            onConfirmCall(
                function () {
                    $.ajax({
                        url: '/DichVuArea/DichVu/UpdateKichHoat',
                        type: 'POST',
                        data: { id: id, kichHoat: newState },
                        success: function (rs) {
                            if (rs.Status) {
                                NotiSuccess("Thành công", "Cập nhật trạng thái thành công");
                                $(moduleTableSelector).hinetTable("reload");
                            } else {
                                NotiError("Thất bại", rs.Message);
                                checkbox.checked = !newState;
                            }
                        },
                        error: function () {
                            NotiError("Thất bại", "Không kết nối được server");
                            checkbox.checked = !newState;
                        }
                    });
                },
                "Xác nhận",
                "Bạn có chắc muốn " + (newState ? "kích hoạt" : "hủy kích hoạt") + " banner này?"
            );

            setTimeout(() => { checkbox.checked = !newState; }, 10);
        }
    </script>
}