@using Newtonsoft.Json;

<style>
    #map {
        width: 100%;
        height: 400px;
    }
</style>


<div id="map"></div>
<script>

    var clickedLat, clickedLng;
    var map;

    var marker = null;
    var center = { lat: 20.054692, lng: 105.363749 };
    var zoom = 8;

    var editLat = $('#latitude').val();
    var editLng = $('#longtitude').val();

    var iconBase = "https://developers.google.com/maps/documentation/javascript/examples/full/images/";
    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: center,
            zoom: zoom,
            mapTypeControl: false
        });

        const wmsLayer = getWMSLayer(map, WMS_UrlMap.layers_BaseMap, '', 1.0);

        // Add the WMS layer to the map
        map.overlayMapTypes.push(wmsLayer);

        drawMarkerEdit();

        map.addListener('click', function (event) {
            var lat = formatToWGS(event.latLng.lat());
            var lng = formatToWGS(event.latLng.lng());

            setLatLng(lat, lng);

            map.setCenter({ lat: lat, lng: lng });
            map.setZoom(14);

            if (marker !== null) {
                marker.setMap(null);
            }

            marker = new google.maps.Marker({
                position: event.latLng,
                map: map
            });
        });
        
    }

    function drawMarkerEdit() {
        if (editLat && editLng) {

            replaceCommaWithDot('latitude');
            replaceCommaWithDot('longtitude');

            editLat = parseFloat($('#latitude').val());
            editLng = parseFloat($('#longtitude').val());

            marker = new google.maps.Marker({
                position: {lat: editLat, lng: editLng},
                map: map
            });
            map.setCenter({ lat: editLat, lng: editLng });
            map.setZoom(14);
        }
    };

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAgEUiZdXI2mRi-wE6aUroT_lPgVbnBAsc&language=vi-VN&callback=initMap&v=weekly"
        defer></script>